<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8">
  <title>Quiz Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    .question { margin-bottom: 20px; }
    .hidden { display: none; }
    button { margin-top: 15px; padding: 10px 20px; }
    #timer { font-weight: bold; color: red; }
  </style>
</head>
<body>

  <h1>–¢–µ—Å—Ç</h1>
  
  <!-- –ê—Ç—ã –µ–Ω–≥—ñ–∑—É -->
  <div id="startDiv">
    <label>–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑: </label>
    <input type="text" id="studentName" placeholder="–ê—Ç—ã“£—ã–∑">
    <button onclick="startQuiz()">–ë–∞—Å—Ç–∞—É</button>
  </div>

  <!-- –¢–∞–π–º–µ—Ä -->
  <div id="timerDiv" class="hidden">
    –£–∞“õ—ã—Ç—ã“£—ã–∑: <span id="timer">02:00</span>
  </div>

  <!-- –¢–µ—Å—Ç —Å“±—Ä–∞“õ—Ç–∞—Ä—ã -->
  <form id="quizForm" class="hidden">
    <div class="question">
      <p>1) HTML –¥–µ–≥–µ–Ω –Ω–µ?</p>
      <label><input type="radio" name="q1" value="a"> a) –í–µ–±-–±–µ—Ç—Ç—ñ –±–µ–ª–≥—ñ–ª–µ—É —Ç—ñ–ª—ñ</label><br>
      <label><input type="radio" name="q1" value="b"> b) –û–π—ã–Ω –±–∞“ì–¥–∞—Ä–ª–∞–º–∞—Å—ã</label><br>
      <label><input type="radio" name="q1" value="c"> c) –ê–Ω—Ç–∏–≤–∏—Ä—É—Å</label>
    </div>

    <div class="question">
      <p>2) CSS –Ω–µ “Ø—à—ñ–Ω “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã?</p>
      <label><input type="radio" name="q2" value="a"> a) –î–µ—Ä–µ–∫—Ç–µ—Ä “õ–æ—Ä—ã–Ω –±–∞—Å“õ–∞—Ä—É</label><br>
      <label><input type="radio" name="q2" value="b"> b) –í–µ–±-–±–µ—Ç—Ç—ñ —Å”ô–Ω–¥–µ—É</label><br>
      <label><input type="radio" name="q2" value="c"> c) –û–ø–µ—Ä–∞—Ü–∏—è–ª—ã“õ –∂“Ø–π–µ–Ω—ñ –±–∞—Å“õ–∞—Ä—É</label>
    </div>

    <button type="button" onclick="finishQuiz()">–ñ–∞—É–∞–ø –±–µ—Ä—É</button>
  </form>

  <!-- –ù”ô—Ç–∏–∂–µ -->
  <div id="resultDiv" class="hidden"></div>

  <script>
    const correctAnswers = { q1: "a", q2: "b" };

    let timer; 
    let timeLeft = 120; // 2 –º–∏–Ω—É—Ç (—Å–µ–∫—É–Ω–¥–ø–µ–Ω)
    let cheatCount = 0; // –∞–Ω—Ç–∏—á–∏—Ç–∏–Ω–≥ —Å–∞–Ω–∞—É

    function startQuiz() {
      let name = document.getElementById("studentName").value.trim();
      if (name === "") {
        alert("–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑!");
        return;
      }
      document.getElementById("startDiv").classList.add("hidden");
      document.getElementById("quizForm").classList.remove("hidden");
      document.getElementById("timerDiv").classList.remove("hidden");

      startTimer();
      enableAntiCheat();
    }

    function startTimer() {
      updateTimer();
      timer = setInterval(() => {
        timeLeft--;
        updateTimer();
        if (timeLeft <= 0) {
          clearInterval(timer);
          alert("–£–∞“õ—ã—Ç—ã“£—ã–∑ –±—ñ—Ç—Ç—ñ!");
          finishQuiz();
        }
      }, 1000);
    }

    function updateTimer() {
      let minutes = Math.floor(timeLeft / 60);
      let seconds = timeLeft % 60;
      document.getElementById("timer").textContent =
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function finishQuiz() {
      clearInterval(timer);
      let form = document.getElementById("quizForm");
      let score = 0, total = Object.keys(correctAnswers).length;

      for (let q in correctAnswers) {
        let answer = form[q].value;
        if (answer === correctAnswers[q]) score++;
      }

      let name = document.getElementById("studentName").value;
      document.getElementById("quizForm").classList.add("hidden");
      document.getElementById("timerDiv").classList.add("hidden");

      let resultDiv = document.getElementById("resultDiv");
      resultDiv.classList.remove("hidden");
      resultDiv.innerHTML = `<h2>${name}, —Å—ñ–∑–¥—ñ“£ –Ω”ô—Ç–∏–∂–µ“£—ñ–∑: ${score} / ${total}</h2>`;

      // Sheets-–∫–µ –∂—ñ–±–µ—Ä—É
      sendResult(name, score, total);
    }

    // Google Sheets-–∫–µ –∂—ñ–±–µ—Ä—É
    function sendResult(name, score, total) {
      fetch("üîó –ú–´–ù–ê“í–ê –°–ï–ù–Ü“¢ Web App URL-–¥—ã “õ–æ–π", {
        method: "POST",
        body: JSON.stringify({ name: name, score: score, total: total })
      })
      .then(res => res.text())
      .then(txt => console.log("Sheets –∂–∞—É–∞–±—ã:", txt))
      .catch(err => console.error("“ö–∞—Ç–µ:", err));
    }

    // –ê–Ω—Ç–∏—á–∏—Ç–∏–Ω–≥
    function enableAntiCheat() {
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          cheatCount++;
          alert("–ù–∞–∑–∞—Ä –∞—É–¥–∞—Ä—ã“£—ã–∑! –°—ñ–∑ –±–∞—Å“õ–∞ –±–µ—Ç–∫–µ —à—ã“õ—Ç—ã“£—ã–∑!");
          if (cheatCount >= 2) { // 2 —Ä–µ—Ç—Ç–µ–Ω –∫–µ–π—ñ–Ω –∞–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ –∞—è“õ—Ç–∞—É
            alert("–ê–Ω—Ç–∏—á–∏—Ç–∏–Ω–≥! –¢–µ—Å—Ç –∞—è“õ—Ç–∞–ª–¥—ã.");
            finishQuiz();
          }
        }
      });
    }
  </script>

</body>
</html>
